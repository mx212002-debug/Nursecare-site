<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NURSECARE ‚Äî Gest√£o em Sa√∫de</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --navy: #0B2340;
            --blue: #0E6BA8;
            --white: #FFFFFF;
            --light-gray: #F4F6F8;
            --text: #222222;
            --border: #E0E0E0;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #dc2626;
            --info: #3b82f6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light-gray);
            color: var(--text);
        }

        .screen {
            display: none;
            min-height: 100vh;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        /* ===== TELA 1: LOGIN ===== */
        #loginScreen {
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--navy) 0%, var(--blue) 100%);
        }

        .login-container {
            background: var(--white);
            border-radius: 15px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            font-size: 28px;
            color: var(--navy);
            margin-bottom: 10px;
        }

        .login-header p {
            color: #666;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--blue);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--navy);
            color: var(--white);
        }

        .btn-primary:hover {
            background: #051a2f;
        }

        .btn-secondary {
            background: var(--light-gray);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 13px;
            width: auto;
            margin: 5px 5px 5px 0;
        }

        /* ===== TELA 2 & 3: APP ===== */
        #gestorScreen,
        #colaboradorScreen {
            flex-direction: column;
        }

        .app-header {
            background: linear-gradient(135deg, var(--navy) 0%, var(--blue) 100%);
            color: var(--white);
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .greeting h2 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .greeting p {
            font-size: 13px;
            opacity: 0.9;
        }

        .header-actions button {
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            color: var(--white);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            margin-left: 10px;
        }

        .app-content {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 80px;
        }

        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--navy);
        }

        .card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .card-title {
            font-weight: 600;
            font-size: 16px;
            color: var(--navy);
            margin-bottom: 10px;
        }

        .card-subtitle {
            font-size: 13px;
            color: #666;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 10px 5px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 12px;
            color: #999;
            transition: all 0.3s;
            border-top: 3px solid transparent;
        }

        .nav-item.active {
            color: var(--navy);
            border-top-color: var(--blue);
            font-weight: 600;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--navy);
            font-size: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            min-height: 100px;
        }

        textarea:focus {
            outline: none;
            border-color: var(--blue);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid var(--danger);
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 4px solid var(--warning);
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid var(--success);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th {
            background: var(--light-gray);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
        }

        .fab {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--blue);
            color: var(--white);
            border: none;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(14, 107, 168, 0.4);
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<!-- ===== TELA 1: LOGIN ===== -->
<div id="loginScreen" class="screen active">
    <div class="login-container">
        <div class="login-header">
            <h1>üè• NURSECARE</h1>
            <p>Gest√£o em Sa√∫de</p>
        </div>
        <div class="form-group">
            <label>Email</label>
            <input type="email" id="loginEmail" placeholder="seu@email.com" value="matheus@nursecare.com">
        </div>
        <div class="form-group">
            <label>Senha</label>
            <input type="password" id="loginPassword" placeholder="Sua senha" value="123456">
        </div>
        <div class="form-group">
            <label>Perfil</label>
            <select id="loginProfile">
                <option value="gestor">üë®‚Äç‚öïÔ∏è Enfermeiro (Gestor)</option>
                <option value="colaborador">üë®‚Äçüíº Colaborador (T√©cnico)</option>
            </select>
        </div>
        <button class="btn btn-primary" onclick="login()">Entrar</button>
    </div>
</div>

<!-- ===== TELA 2: GESTOR ===== -->
<div id="gestorScreen" class="screen">
    <div class="app-header">
        <div class="header-content">
            <div class="greeting">
                <h2>üëã Ol√°, Enfermeiro Matheus</h2>
                <p id="currentDate"></p>
            </div>
            <div class="header-actions">
                <button onclick="logout()">Sair</button>
            </div>
        </div>
    </div>

    <div class="app-content">
        <div class="main-content">
            <!-- DASHBOARD -->
            <div id="gestorDashboard" class="section active">
                <div class="section-title">üìä Dashboard</div>
                
                <div class="alert alert-success">
                    <span>‚ÑπÔ∏è</span>
                    <div>
                        <strong>Resumo do Dia:</strong> 3 evolu√ß√µes registradas ¬∑ 1 paciente em observa√ß√£o ¬∑ 2 alertas cr√≠ticos
                    </div>
                </div>

                <div class="grid">
                    <div class="card">
                        <div class="card-title">üë• Pacientes Ativos</div>
                        <div style="font-size: 32px; font-weight: bold; color: var(--blue);" id="totalPatients">0</div>
                    </div>
                    <div class="card">
                        <div class="card-title">‚ù§Ô∏è Alertas Cr√≠ticos</div>
                        <div style="font-size: 32px; font-weight: bold; color: var(--danger);" id="criticalAlerts">0</div>
                    </div>
                    <div class="card">
                        <div class="card-title">‚úÖ Tarefas Pendentes</div>
                        <div style="font-size: 32px; font-weight: bold; color: var(--warning);" id="pendingTasks">0</div>
                    </div>
                    <div class="card">
                        <div class="card-title">üíä Medicamentos Baixos</div>
                        <div style="font-size: 32px; font-weight: bold; color: var(--warning);" id="lowMeds">0</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">üöÄ Atalhos R√°pidos</div>
                    <button class="btn btn-small btn-primary" onclick="showModal('addPatientModal')">+ Novo Paciente</button>
                    <button class="btn btn-small btn-primary" onclick="showModal('addCollaboratorModal')">+ Novo Colaborador</button>
                    <button class="btn btn-small btn-primary" onclick="showSection('gestorReports')">üìä Gerar Relat√≥rio</button>
                </div>
            </div>

            <!-- PACIENTES -->
            <div id="gestorPatients" class="section">
                <div class="section-title">üë• Pacientes</div>
                <button class="btn btn-primary" onclick="showModal('addPatientModal')" style="margin-bottom: 20px;">+ Novo Paciente</button>
                <div id="patientsList"></div>
            </div>

            <!-- AVALIA√á√ÉO CL√çNICA -->
            <div id="gestorEvaluation" class="section">
                <div class="section-title">üìã Avalia√ß√£o Cl√≠nica</div>
                <button class="btn btn-primary" onclick="showModal('addEvaluationModal')" style="margin-bottom: 20px;">+ Nova Avalia√ß√£o</button>
                <div id="evaluationsList"></div>
            </div>

            <!-- FARM√ÅCIA -->
            <div id="gestorPharmacy" class="section">
                <div class="section-title">üíä Farm√°cia</div>
                <button class="btn btn-primary" onclick="showModal('addMedicineModal')" style="margin-bottom: 20px;">+ Novo Medicamento</button>
                <div id="medicinesList"></div>
            </div>

            <!-- ALMOXARIFADO -->
            <div id="gestorWarehouse" class="section">
                <div class="section-title">üì¶ Almoxarifado</div>
                <button class="btn btn-primary" onclick="showModal('addMaterialModal')" style="margin-bottom: 20px;">+ Novo Material</button>
                <div id="materialsList"></div>
            </div>

            <!-- COLABORADORES -->
            <div id="gestorCollaborators" class="section">
                <div class="section-title">üë• Colaboradores</div>
                <button class="btn btn-primary" onclick="showModal('addCollaboratorModal')" style="margin-bottom: 20px;">+ Novo Colaborador</button>
                <div id="collaboratorsList"></div>
            </div>

            <!-- CHAT -->
            <div id="gestorChat" class="section">
                <div class="section-title">üí¨ Fale com o Enfermeiro</div>
                <div class="card">
                    <div class="card-title">üìû Contato Direto</div>
                    <p><strong>Matheus da Silva</strong></p>
                    <p>üìû (11) 98520-9793</p>
                    <p>üìß enf.matheus37284363@gmail.com</p>
                </div>
                <div style="background: var(--light-gray); border-radius: 8px; padding: 15px; margin: 15px 0; height: 300px; overflow-y: auto;" id="chatMessages"></div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="chatInput" placeholder="Digite sua mensagem..." style="flex: 1; padding: 10px; border: 2px solid var(--border); border-radius: 8px;">
                    <button class="btn btn-primary" onclick="sendMessage()" style="width: auto;">Enviar</button>
                </div>
            </div>

            <!-- RELAT√ìRIOS -->
            <div id="gestorReports" class="section">
                <div class="section-title">üìä Relat√≥rios</div>
                <div class="form-group">
                    <label>Tipo de Relat√≥rio</label>
                    <select id="reportType">
                        <option value="daily">Di√°rio</option>
                        <option value="weekly">Semanal</option>
                        <option value="monthly">Mensal</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="generateReport()">Gerar Relat√≥rio</button>
                <button class="btn btn-secondary" onclick="exportReportPDF()" style="margin-top: 10px;">üì• Exportar PDF</button>
            </div>
        </div>
    </div>

    <button class="fab" onclick="showModal('aiAssistantModal')">ü§ñ</button>

    <div class="bottom-nav">
        <button class="nav-item active" onclick="switchGestorSection('gestorDashboard')">üìä Dashboard</button>
        <button class="nav-item" onclick="switchGestorSection('gestorPatients')">üë• Pacientes</button>
        <button class="nav-item" onclick="switchGestorSection('gestorEvaluation')">üìã Avalia√ß√£o</button>
        <button class="nav-item" onclick="switchGestorSection('gestorPharmacy')">üíä Farm√°cia</button>
        <button class="nav-item" onclick="switchGestorSection('gestorWarehouse')">üì¶ Almoxarifado</button>
        <button class="nav-item" onclick="switchGestorSection('gestorChat')">üí¨ Chat</button>
    </div>
</div>

<!-- ===== TELA 3: COLABORADOR ===== -->
<div id="colaboradorScreen" class="screen">
    <div class="app-header">
        <div class="header-content">
            <div class="greeting">
                <h2>üëã Ol√°, T√©cnico Jo√£o</h2>
                <p id="currentDateColaborador"></p>
            </div>
            <div class="header-actions">
                <button onclick="logout()">Sair</button>
            </div>
        </div>
    </div>

    <div class="app-content">
        <div class="main-content">
            <!-- PACIENTES -->
            <div id="colaboradorPatients" class="section active">
                <div class="section-title">üë• Meus Pacientes</div>
                <div id="colaboradorPatientsList"></div>
            </div>

            <!-- SINAIS VITAIS -->
            <div id="colaboradorVitals" class="section">
                <div class="section-title">‚ù§Ô∏è Sinais Vitais</div>
                <button class="btn btn-primary" onclick="showModal('addVitalsModal')" style="margin-bottom: 20px;">+ Registrar Sinais</button>
                <div id="vitalsList"></div>
            </div>

            <!-- AVALIA√á√ÉO T√âCNICA -->
            <div id="colaboradorTechnicalEval" class="section">
                <div class="section-title">üìù Avalia√ß√£o T√©cnica</div>
                <button class="btn btn-primary" onclick="showModal('addTechnicalEvalModal')" style="margin-bottom: 20px;">+ Nova Avalia√ß√£o</button>
                <div id="technicalEvalList"></div>
            </div>

            <!-- SOLICITA√á√ïES -->
            <div id="colaboradorRequests" class="section">
                <div class="section-title">üìã Solicita√ß√µes</div>
                <button class="btn btn-primary" onclick="showModal('requestMedicineModal')" style="margin-bottom: 10px;">üíä Solicitar Medica√ß√£o</button>
                <button class="btn btn-primary" onclick="showModal('requestMaterialModal')" style="margin-bottom: 20px;">üì¶ Solicitar Material</button>
                <div id="requestsList"></div>
            </div>

            <!-- TAREFAS -->
            <div id="colaboradorTasks" class="section">
                <div class="section-title">‚úÖ Minhas Tarefas</div>
                <div id="tasksList"></div>
            </div>

            <!-- CHAT -->
            <div id="colaboradorChat" class="section">
                <div class="section-title">üí¨ Chat por Setor</div>
                <div class="form-group">
                    <label>Setor</label>
                    <select id="chatSector">
                        <option value="enfermagem">Enfermagem</option>
                        <option value="farmacia">Farm√°cia</option>
                        <option value="coordenacao">Coordena√ß√£o</option>
                    </select>
                </div>
                <div style="background: var(--light-gray); border-radius: 8px; padding: 15px; margin: 15px 0; height: 300px; overflow-y: auto;" id="colaboradorChatMessages"></div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="colaboradorChatInput" placeholder="Digite sua mensagem..." style="flex: 1; padding: 10px; border: 2px solid var(--border); border-radius: 8px;">
                    <button class="btn btn-primary" onclick="sendColaboradorMessage()" style="width: auto;">Enviar</button>
                </div>
            </div>

            <!-- POP EMERG√äNCIAS -->
            <div id="colaboradorPOP" class="section">
                <div class="section-title">üö® POP de Emerg√™ncias</div>
                <div class="card">
                    <div class="card-title">Cola de SSVV Normais</div>
                    <table>
                        <tr><th>Par√¢metro</th><th>Normal</th></tr>
                        <tr><td>PA</td><td>120/80 mmHg</td></tr>
                        <tr><td>FC</td><td>60-100 bpm</td></tr>
                        <tr><td>FR</td><td>12-20 irpm</td></tr>
                        <tr><td>Temperatura</td><td>36,5-37,5¬∞C</td></tr>
                        <tr><td>SpO‚ÇÇ</td><td>95-100%</td></tr>
                    </table>
                </div>
                <div class="card">
                    <div class="card-title">Primeiros Socorros</div>
                    <ul style="margin-left: 20px;">
                        <li><strong>Queda:</strong> Imobilizar, chamar m√©dico</li>
                        <li><strong>Convuls√£o:</strong> Proteger cabe√ßa, posi√ß√£o lateral</li>
                        <li><strong>Desmaio:</strong> Deitar, elevar pernas</li>
                    </ul>
                </div>
                <div class="card">
                    <div class="card-title">üìû N√∫meros de Emerg√™ncia</div>
                    <p><strong>SAMU:</strong> 192</p>
                    <p><strong>Bombeiros:</strong> 193</p>
                    <p><strong>Enfermeiro:</strong> (11) 98520-9793</p>
                </div>
            </div>
        </div>
    </div>

    <button class="fab" onclick="showModal('aiAssistantModal')">ü§ñ</button>

    <div class="bottom-nav">
        <button class="nav-item active" onclick="switchColaboradorSection('colaboradorPatients')">üë• Pacientes</button>
        <button class="nav-item" onclick="switchColaboradorSection('colaboradorVitals')">‚ù§Ô∏è Sinais</button>
        <button class="nav-item" onclick="switchColaboradorSection('colaboradorTechnicalEval')">üìù Avalia√ß√£o</button>
        <button class="nav-item" onclick="switchColaboradorSection('colaboradorRequests')">üìã Solicita√ß√µes</button>
        <button class="nav-item" onclick="switchColaboradorSection('colaboradorChat')">üí¨ Chat</button>
        <button class="nav-item" onclick="switchColaboradorSection('colaboradorPOP')">üö® POP</button>
    </div>
</div>

<!-- ===== MODALS ===== -->

<!-- ADD PATIENT MODAL -->
<div id="addPatientModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Novo Paciente</h2>
            <button class="modal-close" onclick="closeModal('addPatientModal')">‚úï</button>
        </div>
        <div class="form-group">
            <label>Nome Completo *</label>
            <input type="text" id="patientName" placeholder="Nome do paciente">
        </div>
        <div class="form-group">
            <label>Leito/Quarto *</label>
            <input type="text" id="patientBed" placeholder="Ex: 305">
        </div>
        <div class="form-group">
            <label>Status</label>
            <select id="patientStatus">
                <option value="ativo">Ativo</option>
                <option value="critico">Cr√≠tico</option>
                <option value="observacao">Observa√ß√£o</option>
                <option value="alta">Alta</option>
                <option value="obito">√ìbito</option>
            </select>
        </div>
        <button class="btn btn-primary" onclick="addPatient()">Salvar</button>
    </div>
</div>

<!-- ADD EVALUATION MODAL (GESTOR) -->
<div id="addEvaluationModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üìã Avalia√ß√£o Cl√≠nica (SOAPIE)</h2>
            <button class="modal-close" onclick="closeModal('addEvaluationModal')">‚úï</button>
        </div>
        
        <div class="form-group">
            <label>Paciente *</label>
            <select id="evalPatient"></select>
        </div>

        <div class="form-group">
            <label>Data e Hora *</label>
            <input type="datetime-local" id="evalDateTime">
        </div>

        <div class="form-group">
            <label><strong>S - Subjetivo:</strong> Queixas/Relatos</label>
            <textarea id="evalSubjective" placeholder="Queixas do paciente..."></textarea>
        </div>

        <div class="form-group">
            <label><strong>O - Objetivo:</strong> Sinais Vitais</label>
            <div class="form-row">
                <input type="text" id="evalPA" placeholder="PA (ex: 120/80)">
                <input type="number" id="evalFC" placeholder="FC (bpm)">
            </div>
            <div class="form-row">
                <input type="number" id="evalFR" placeholder="FR (irpm)">
                <input type="number" id="evalTemp" placeholder="Temp (¬∞C)" step="0.1">
            </div>
            <input type="number" id="evalSpO2" placeholder="SpO‚ÇÇ (%)" style="width: 100%; margin-bottom: 10px;">
            <textarea id="evalObjectiveNotes" placeholder="Estado geral, pele, dispositivos..."></textarea>
        </div>

        <div class="form-group">
            <label><strong>A - An√°lise:</strong> Interpreta√ß√£o Cl√≠nica</label>
            <textarea id="evalAnalysis" placeholder="Interpreta√ß√£o do quadro..."></textarea>
        </div>

        <div class="form-group">
            <label><strong>P - Plano:</strong> Condutas e Interven√ß√µes</label>
            <textarea id="evalPlan" placeholder="Cuidados, medicamentos, orienta√ß√µes..."></textarea>
        </div>

        <div class="form-group">
            <label><strong>E - Evolu√ß√£o:</strong> Resposta aos Cuidados</label>
            <textarea id="evalEvolution" placeholder="Melhoras, pioras, manuten√ß√£o..."></textarea>
        </div>

        <button class="btn btn-secondary" onclick="generateAutoEvolution()" style="margin-bottom: 10px;">ü§ñ Gerar Evolu√ß√£o Autom√°tica</button>
        <button class="btn btn-primary" onclick="addEvaluation()">Salvar Avalia√ß√£o</button>
    </div>
</div>

<!-- ADD VITALS MODAL (COLABORADOR) -->
<div id="addVitalsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>‚ù§Ô∏è Registrar Sinais Vitais</h2>
            <button class="modal-close" onclick="closeModal('addVitalsModal')">‚úï</button>
        </div>
        <div class="form-group">
            <label>Paciente *</label>
            <select id="vitalsPatient"></select>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>PA (mmHg) *</label>
                <input type="text" id="vitalPA" placeholder="Ex: 120/80">
            </div>
            <div class="form-group">
                <label>FC (bpm) *</label>
                <input type="number" id="vitalFC" placeholder="Ex: 72">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>FR (irpm) *</label>
                <input type="number" id="vitalFR" placeholder="Ex: 16">
            </div>
            <div class="form-group">
                <label>Temperatura (¬∞C) *</label>
                <input type="number" id="vitalTemp" placeholder="Ex: 36.5" step="0.1">
            </div>
        </div>
        <div class="form-group">
            <label>SpO‚ÇÇ (%) *</label>
            <input type="number" id="vitalSpO2" placeholder="Ex: 98" min="0" max="100">
        </div>
        <button class="btn btn-primary" onclick="addVitals()">Registrar</button>
    </div>
</div>

<!-- ADD TECHNICAL EVALUATION MODAL (COLABORADOR) -->
<div id="addTechnicalEvalModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üìù Avalia√ß√£o T√©cnica</h2>
            <button class="modal-close" onclick="closeModal('addTechnicalEvalModal')">‚úï</button>
        </div>
        <div class="form-group">
            <label>Paciente *</label>
            <select id="technicalEvalPatient"></select>
        </div>
        <div class="form-group">
            <label>Data e Hora *</label>
            <input type="datetime-local" id="technicalEvalDateTime">
        </div>
        <div class="form-group">
            <label>Anota√ß√µes de Evolu√ß√£o *</label>
            <textarea id="technicalEvalNotes" placeholder="Descreva o atendimento..."></textarea>
        </div>
        <button class="btn btn-primary" onclick="addTechnicalEvaluation()">Salvar</button>
    </div>
</div>

<!-- ADD MEDICINE MODAL -->
<div id="addMedicineModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üíä Novo Medicamento</h2>
            <button class="modal-close" onclick="closeModal('addMedicineModal')">‚úï</button>
        </div>
        <div class="form-group">
            <label>Nome *</label>
            <input type="text" id="medicineName" placeholder="Ex: Dipirona 500mg">
        </div>
        <div class="form-group">
            <label>Quantidade *</label>
            <input type="number" id="medicineQty" placeholder="Ex: 100">
        </div>
        <div class="form-group">
            <label>Validade *</label>
            <input type="date" id="medicineExpiry">
        </div>
        <div class="form-group">
            <label>Quantidade M√≠nima *</label>
            <input type="number" id="medicineMinQty" placeholder="Ex: 20">
        </div>
        <button class="btn btn-primary" onclick="addMedicine()">Salvar</button>
    </div>
</div>

<!-- ADD MATERIAL MODAL -->
<div id="addMaterialModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üì¶ Novo Material</h2>
            <button class="modal-close" onclick="closeModal('addMaterialModal')">‚úï</button>
        </div>
        <div class="form-group">
            <label>Nome *</label>
            <input type="text" id="materialName" placeholder="Ex: Gaze est√©ril">
        </div>
        <div class="form-group">
            <label>Quantidade *</label>
            <input type="number" id="materialQty" placeholder="Ex: 500">
        </div>
        <div class="form-group">
            <label>Setor</label>
            <select id="materialSector">
                <option value="enfermagem">Enfermagem</option>
                <option value="farmacia">Farm√°cia</option>
                <option value="coordenacao">Coordena√ß√£o</option>
            </select>
        </div>
        <button class="btn btn-primary" onclick="addMaterial()">Salvar</button>
    </div>
</div>

<!-- ADD COLLABORATOR MODAL -->
<div id="addCollaboratorModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üë• Novo Colaborador</h2>
            <button class="modal-close" onclick="closeModal('addCollaboratorModal')">‚úï</button>
        </div>
        <div class="form-group">
            <label>Nome *</label>
            <input type="text" id="collabName" placeholder="Nome completo">
        </div>
        <div class="form-group">
            <label>Email *</label>
            <input type="email" id="collabEmail" placeholder="email@example.com">
        </div>
        <div class="form-group">
            <label>Fun√ß√£o</label>
            <select id="collabRole">
                <option value="tecnico">T√©cnico de Enfermagem</option>
                <option value="auxiliar">Auxiliar de Enfermagem</option>
                <option value="cuidador">Cuidador</option>
            </select>
        </div>
        <button class="btn btn-primary" onclick="addCollaborator()">Salvar</button>
    </div>
</div>

<!-- REQUEST MEDICINE MODAL -->
<div id="requestMedicineModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üíä Solicitar Medica√ß√£o</h2>
            <button class="modal-close" onclick="closeModal('requestMedicineModal')">‚úï</button>
        </div>
        <div class="form-group">
            <label>Paciente *</label>
            <select id="requestMedicinePatient"></select>
        </div>
        <div class="form-group">
            <label>Medicamento *</label>
            <select id="requestMedicineSelect"></select>
        </div>
        <div class="form-group">
            <label>Quantidade *</label>
            <input type="number" id="requestMedicineQty" placeholder="Ex: 2">
        </div>
        <button class="btn btn-primary" onclick="requestMedicine()">Solicitar</button>
    </div>
</div>

<!-- REQUEST MATERIAL MODAL -->
<div id="requestMaterialModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üì¶ Solicitar Material</h2>
            <button class="modal-close" onclick="closeModal('requestMaterialModal')">‚úï</button>
        </div>
        <div class="form-group">
            <label>Paciente *</label>
            <select id="requestMaterialPatient"></select>
        </div>
        <div class="form-group">
            <label>Material *</label>
            <select id="requestMaterialSelect"></select>
        </div>
        <div class="form-group">
            <label>Quantidade *</label>
            <input type="number" id="requestMaterialQty" placeholder="Ex: 5">
        </div>
        <button class="btn btn-primary" onclick="requestMaterial()">Solicitar</button>
    </div>
</div>

<!-- AI ASSISTANT MODAL -->
<div id="aiAssistantModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>ü§ñ Assistente IA</h2>
            <button class="modal-close" onclick="closeModal('aiAssistantModal')">‚úï</button>
        </div>
        <div id="aiContent" style="background: var(--light-gray); padding: 15px; border-radius: 8px; margin: 15px 0; min-height: 200px; max-height: 400px; overflow-y: auto;"></div>
        <button class="btn btn-primary" onclick="generateAISummary()">Gerar Resumo do Dia</button>
    </div>
</div>

<script>
// ===== DATA =====
let app = {
    currentUser: null,
    patients: [],
    evaluations: [],
    vitals: [],
    technicalEvals: [],
    medicines: [],
    materials: [],
    collaborators: [],
    requests: [],
    tasks: [],
    messages: [],
    auditLog: []
};

// ===== AUTHENTICATION =====
function login() {
    const email = document.getElementById('loginEmail').value;
    const profile = document.getElementById('loginProfile').value;

    if (!email) {
        alert('Por favor, preencha o email');
        return;
    }

    app.currentUser = {
        email: email,
        name: profile === 'gestor' ? 'Matheus da Silva' : 'Jo√£o Silva',
        profile: profile,
        coren: '677328'
    };

    document.getElementById('loginScreen').classList.remove('active');
    
    if (profile === 'gestor') {
        document.getElementById('gestorScreen').classList.add('active');
    } else {
        document.getElementById('colaboradorScreen').classList.add('active');
    }

    updateDateTime();
    loadAllData();
}

function logout() {
    if (confirm('Deseja realmente sair?')) {
        app.currentUser = null;
        document.getElementById('loginScreen').classList.add('active');
        document.getElementById('gestorScreen').classList.remove('active');
        document.getElementById('colaboradorScreen').classList.remove('active');
    }
}

// ===== NAVIGATION =====
function switchGestorSection(sectionId) {
    document.querySelectorAll('#gestorScreen .section').forEach(s => s.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
    
    document.querySelectorAll('#gestorScreen .nav-item').forEach(n => n.classList.remove('active'));
    event.target.classList.add('active');

    if (sectionId === 'gestorPatients') loadPatients();
    if (sectionId === 'gestorEvaluation') loadEvaluations();
    if (sectionId === 'gestorPharmacy') loadMedicines();
    if (sectionId === 'gestorWarehouse') loadMaterials();
    if (sectionId === 'gestorCollaborators') loadCollaborators();
}

function switchColaboradorSection(sectionId) {
    document.querySelectorAll('#colaboradorScreen .section').forEach(s => s.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
    
    document.querySelectorAll('#colaboradorScreen .nav-item').forEach(n => n.classList.remove('active'));
    event.target.classList.add('active');

    if (sectionId === 'colaboradorPatients') loadColaboradorPatients();
    if (sectionId === 'colaboradorVitals') loadVitals();
    if (sectionId === 'colaboradorTechnicalEval') loadTechnicalEvals();
    if (sectionId === 'colaboradorRequests') loadRequests();
    if (sectionId === 'colaboradorTasks') loadTasks();
}

// ===== MODALS =====
function showModal(modalId) {
    document.getElementById(modalId).classList.add('active');
    if (modalId === 'addEvaluationModal') populatePatientSelects();
    if (modalId === 'addVitalsModal') populatePatientSelects();
    if (modalId === 'addTechnicalEvalModal') populatePatientSelects();
    if (modalId === 'requestMedicineModal') {
        populatePatientSelects();
        populateMedicineSelect();
    }
    if (modalId === 'requestMaterialModal') {
        populatePatientSelects();
        populateMaterialSelect();
    }
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
}

// ===== PATIENTS =====
function addPatient() {
    const name = document.getElementById('patientName').value;
    const bed = document.getElementById('patientBed').value;
    const status = document.getElementById('patientStatus').value;

    if (!name || !bed) {
        alert('Preencha os campos obrigat√≥rios (*)');
        return;
    }

    const patient = {
        id: Date.now(),
        name: name,
        bed: bed,
        status: status,
        createdAt: new Date().toLocaleString('pt-BR')
    };

    app.patients.push(patient);
    saveToLocalStorage();
    loadPatients();
    closeModal('addPatientModal');
    
    document.getElementById('patientName').value = '';
    document.getElementById('patientBed').value = '';
    document.getElementById('totalPatients').textContent = app.patients.length;
}

function loadPatients() {
    const list = document.getElementById('patientsList');
    list.innerHTML = '';

    if (app.patients.length === 0) {
        list.innerHTML = '<p style="color: #999;">Nenhum paciente cadastrado</p>';
        return;
    }

    app.patients.forEach(patient => {
        const statusClass = patient.status === 'critico' ? 'badge-danger' : 
                           patient.status === 'observacao' ? 'badge-warning' : 'badge-success';
        
        list.innerHTML += `
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div class="card-title">${patient.name}</div>
                        <div class="card-subtitle">Leito: ${patient.bed}</div>
                    </div>
                    <span class="badge ${statusClass}">${patient.status.toUpperCase()}</span>
                </div>
                <div style="margin-top: 10px;">
                    <button class="btn btn-small btn-danger" onclick="deletePatient(${patient.id})">Deletar</button>
                </div>
            </div>
        `;
    });
}

function loadColaboradorPatients() {
    const list = document.getElementById('colaboradorPatientsList');
    list.innerHTML = '';

    if (app.patients.length === 0) {
        list.innerHTML = '<p style="color: #999;">Nenhum paciente atribu√≠do</p>';
        return;
    }

    app.patients.forEach(patient => {
        list.innerHTML += `
            <div class="card">
                <div class="card-title">${patient.name}</div>
                <div class="card-subtitle">Leito: ${patient.bed}</div>
                <div style="margin-top: 10px;">
                    <button class="btn btn-small btn-primary" onclick="showModal('addVitalsModal')">Registrar Sinais</button>
                    <button class="btn btn-small btn-primary" onclick="showModal('addTechnicalEvalModal')">Avalia√ß√£o</button>
                </div>
            </div>
        `;
    });
}

function deletePatient(id) {
    if (confirm('Deseja deletar este paciente?')) {
        app.patients = app.patients.filter(p => p.id !== id);
        saveToLocalStorage();
        loadPatients();
    }
}

// ===== EVALUATIONS =====
function addEvaluation() {
    const patientId = parseInt(document.getElementById('evalPatient').value);
    const patient = app.patients.find(p => p.id === patientId);

    if (!patientId) {
        alert('Selecione um paciente');
        return;
    }

    const evaluation = {
        id: Date.now(),
        patientId: patientId,
        patientName: patient.name,
        dateTime: document.getElementById('evalDateTime').value,
        subjetivo: document.getElementById('evalSubjective').value,
        pa: document.getElementById('evalPA').value,
        fc: document.getElementById('evalFC').value,
        fr: document.getElementById('evalFR').value,
        temp: document.getElementById('evalTemp').value,
        spo2: document.getElementById('evalSpO2').value,
        objectiveNotes: document.getElementById('evalObjectiveNotes').value,
        analise: document.getElementById('evalAnalysis').value,
        plano: document.getElementById('evalPlan').value,
        evolucao: document.getElementById('evalEvolution').value,
        author: app.currentUser.name,
        coren: app.currentUser.coren,
        timestamp: new Date().toLocaleString('pt-BR')
    };

    app.evaluations.push(evaluation);
    saveToLocalStorage();
    loadEvaluations();
    closeModal('addEvaluationModal');
    alert('‚úÖ Avalia√ß√£o salva com sucesso!');
}

function loadEvaluations() {
    const list = document.getElementById('evaluationsList');
    list.innerHTML = '';

    if (app.evaluations.length === 0) {
        list.innerHTML = '<p style="color: #999;">Nenhuma avalia√ß√£o registrada</p>';
        return;
    }

    app.evaluations.slice().reverse().forEach(eval => {
        list.innerHTML += `
            <div class="card">
                <div class="card-title">${eval.patientName}</div>
                <div class="card-subtitle">${eval.dateTime}</div>
                <p><small><strong>Autor:</strong> ${eval.author} - COREN ${eval.coren}</small></p>
                <button class="btn btn-small btn-secondary" onclick="exportEvaluation(${eval.id})">üì• Exportar</button>
            </div>
        `;
    });
}

function generateAutoEvolution() {
    const subj = document.getElementById('evalSubjective').value;
    const pa = document.getElementById('evalPA').value;
    const fc = document.getElementById('evalFC').value;
    const temp = document.getElementById('evalTemp').value;
    
    const autoEvolution = `Paciente l√∫cido, orientado e colaborativo. Refere ${subj.toLowerCase() || 'bem-estar'}. Sinais vitais: PA ${pa}, FC ${fc}, T ${temp}¬∞C. Apresenta evolu√ß√£o favor√°vel, mantendo-se clinicamente est√°vel sem intercorr√™ncias.`;
    
    document.getElementById('evalEvolution').value = autoEvolution;
    alert('‚úÖ Evolu√ß√£o gerada automaticamente!');
}

function exportEvaluation(id) {
    const eval = app.evaluations.find(e => e.id === id);
    const content = `AVALIA√á√ÉO CL√çNICA (SOAPIE)\n\nData: ${eval.dateTime}\nPaciente: ${eval.patientName}\n\nS - SUBJETIVO:\n${eval.subjetivo}\n\nO - OBJETIVO:\nPA: ${eval.pa} | FC: ${eval.fc} | FR: ${eval.fr} | T: ${eval.temp}¬∞C | SpO‚ÇÇ: ${eval.spo2}%\n${eval.objectiveNotes}\n\nA - AN√ÅLISE:\n${eval.analise}\n\nP - PLANO:\n${eval.plano}\n\nE - EVOLU√á√ÉO:\n${eval.evolucao}\n\nAutor: ${eval.author}\nCOREN: ${eval.coren}\nData de Registro: ${eval.timestamp}`;
    
    downloadFile(content, `avaliacao_${eval.patientName}.txt`);
}

// ===== VITALS =====
function addVitals() {
    const patientId = parseInt(document.getElementById('vitalsPatient').value);
    const pa = document.getElementById('vitalPA').value;
    const fc = parseInt(document.getElementById('vitalFC').value);
    const fr = parseInt(document.getElementById('vitalFR').value);
    const temp = parseFloat(document.getElementById('vitalTemp').value);
    const spo2 = parseInt(document.getElementById('vitalSpO2').value);

    if (!patientId || !pa || !fc || !fr || !temp || !spo2) {
        alert('Preencha todos os campos obrigat√≥rios (*)');
        return;
    }

    const patient = app.patients.find(p => p.id === patientId);
    const vital = {
        id: Date.now(),
        patientId: patientId,
        patientName: patient.name,
        pa: pa,
        fc: fc,
        fr: fr,
        temp: temp,
        spo2: spo2,
        timestamp: new Date().toLocaleString('pt-BR'),
        isAbnormal: fc < 60 || fc > 100 || temp < 36 || temp > 37.5 || spo2 < 95
    };

    app.vitals.push(vital);
    saveToLocalStorage();
    loadVitals();
    closeModal('addVitalsModal');
    alert('‚úÖ Sinais vitais registrados!');
    
    document.getElementById('vitalPA').value = '';
    document.getElementById('vitalFC').value = '';
    document.getElementById('vitalFR').value = '';
    document.getElementById('vitalTemp').value = '';
    document.getElementById('vitalSpO2').value = '';
}

function loadVitals() {
    const list = document.getElementById('vitalsList');
    list.innerHTML = '';

    if (app.vitals.length === 0) {
        list.innerHTML = '<p style="color: #999;">Nenhum registro de sinais vitais</p>';
        return;
    }

    app.vitals.slice().reverse().forEach(vital => {
        const alertClass = vital.isAbnormal ? 'alert-danger' : 'alert-success';
        list.innerHTML += `
            <div class="alert ${alertClass}">
                <span>${vital.isAbnormal ? '‚ö†Ô∏è' : '‚úÖ'}</span>
                <div>
                    <strong>${vital.patientName}</strong><br>
                    PA: ${vital.pa} | FC: ${vital.fc} | FR: ${vital.fr} | T: ${vital.temp}¬∞C | SpO‚ÇÇ: ${vital.spo2}%<br>
                    <small>${vital.timestamp}</small>
                </div>
            </div>
        `;
    });

    document.getElementById('criticalAlerts').textContent = app.vitals.filter(v => v.isAbnormal).length;
}

// ===== TECHNICAL EVALUATIONS =====
function addTechnicalEvaluation() {
    const patientId = parseInt(document.getElementById('technicalEvalPatient').value);
    const notes = document.getElementById('technicalEvalNotes').value;

    if (!patientId || !notes) {
        alert('Preencha todos os campos obrigat√≥rios (*)');
        return;
    }

    const patient = app.patients.find(p => p.id === patientId);
    const eval = {
        id: Date.now(),
        patientId: patientId,
        patientName: patient.name,
        dateTime: document.getElementById('technicalEvalDateTime').value,
        notes: notes,
        author: app.currentUser.name,
        timestamp: new Date().toLocaleString('pt-BR')
    };

    app.technicalEvals.push(eval);
    saveToLocalStorage();
    loadTechnicalEvals();
    closeModal('addTechnicalEvalModal');
    alert('‚úÖ Avalia√ß√£o t√©cnica registrada!');
}

function loadTechnicalEvals() {
    const list = document.getElementById('technicalEvalList');
    list.innerHTML = '';

    if (app.technicalEvals.length === 0) {
        list.innerHTML = '<p style="color: #999;">Nenhuma avalia√ß√£o registrada</p>';
        return;
    }

    app.technicalEvals.slice().reverse().forEach(eval => {
        list.innerHTML += `
            <div class="card">
                <div class="card-title">${eval.patientName}</div>
                <div class="card-subtitle">${eval.dateTime}</div>
                <p>${eval.notes.substring(0, 100)}...</p>
                <small>Por: ${eval.author}</small>
            </div>
        `;
    });
}

// ===== MEDICINES =====
function addMedicine() {
    const name = document.getElementById('medicineName').value;
    const qty = parseInt(document.getElementById('medicineQty').value);
    const expiry = document.getElementById('medicineExpiry').value;
    const minQty = parseInt(document.getElementById('medicineMinQty').value);

    if (!name || !qty || !expiry || !minQty) {
        alert('Preencha todos os campos obrigat√≥rios (*)');
        return;
    }

    const medicine = {
        id: Date.now(),
        name: name,
        quantity: qty,
        expiry: expiry,
        minQuantity: minQty,
        createdAt: new Date().toLocaleString('pt-BR')
    };

    app.medicines.push(medicine);
    saveToLocalStorage();
    loadMedicines();
    closeModal('addMedicineModal');
    alert('‚úÖ Medicamento adicionado!');
}

function loadMedicines() {
    const list = document.getElementById('medicinesList');
    list.innerHTML = '';

    if (app.medicines.length === 0) {
        list.innerHTML = '<p style="color: #999;">Nenhum medicamento cadastrado</p>';
        return;
    }

    app.medicines.forEach(med => {
        const isLow = med.quantity <= med.minQuantity;
        const isExpired = new Date(med.expiry) < new Date();
        const statusClass = isExpired ? 'badge-danger' : isLow ? 'badge-warning' : 'badge-success';
        
        list.innerHTML += `
            <div class="card">
                <div style="display: flex; justify-content: space-between;">
                    <div>
                        <div class="card-title">${med.name}</div>
                        <div class="card-subtitle">Estoque: ${med.quantity} | Validade: ${med.expiry}</div>
                    </div>
                    <span class="badge ${statusClass}">${isExpired ? 'VENCIDO' : isLow ? 'BAIXO' : 'OK'}</span>
                </div>
            </div>
        `;
    });

    document.getElementById('lowMeds').textContent = app.medicines.filter(m => m.quantity <= m.minQuantity).length;
}

// ===== MATERIALS =====
function addMaterial() {
    const name = document.getElementById('materialName').value;
    const qty = parseInt(document.getElementById('materialQty').value);
    const sector = document.getElementById('materialSector').value;

    if (!name || !qty || !sector) {
        alert('Preencha todos os campos obrigat√≥rios (*)');
        return;
    }

    const material = {
        id: Date.now(),
        name: name,
        quantity: qty,
        sector: sector,
        createdAt: new Date().toLocaleString('pt-BR')
    };

    app.materials.push(material);
    saveToLocalStorage();
    loadMaterials();
    closeModal('addMaterialModal');
    alert('‚úÖ Material adicionado!');
}

function loadMaterials() {
    const list = document.getElementById('materialsList');
    list.innerHTML = '';

    if (app.materials.length === 0) {
        list.innerHTML = '<p style="color: #999;">Nenhum material cadastrado</p>';
        return;
    }

    app.materials.forEach(mat => {
        list.innerHTML += `
            <div class="card">
                <div class="card-title">${mat.name}</div>
                <div class="card-subtitle">Setor: ${mat.sector} | Qtd: ${mat.quantity}</div>
            </div>
        `;
    });
}

// ===== COLLABORATORS =====
function addCollaborator() {
    const name = document.getElementById('collabName').value;
    const email = document.getElementById('collabEmail').value;
    const role = document.getElementById('collabRole').value;

    if (!name || !email || !role) {
        alert('Preencha todos os campos obrigat√≥rios (*)');
        return;
    }

    const collaborator = {
        id: Date.now(),
        name: name,
        email: email,
        role: role,
        status: 'ativo',
        createdAt: new Date().toLocaleString('pt-BR')
    };

    app.collaborators.push(collaborator);
    saveToLocalStorage();
    loadCollaborators();
    closeModal('addCollaboratorModal');
    alert('‚úÖ Colaborador adicionado!');
}

function loadCollaborators() {
    const list = document.getElementById('collaboratorsList');
    list.innerHTML = '';

    if (app.collaborators.length === 0) {
        list.innerHTML = '<p style="color: #999;">Nenhum colaborador cadastrado</p>';
        return;
    }

    app.collaborators.forEach(collab => {
        list.innerHTML += `
            <div class="card">
                <div style="display: flex; justify-content: space-between;">
                    <div>
                        <div class="card-title">${collab.name}</div>
                        <div class="card-subtitle">${collab.role} | ${collab.email}</div>
                    </div>
                    <span class="badge badge-success">${collab.status.toUpperCase()}</span>
                </div>
            </div>
        `;
    });
}

// ===== REQUESTS =====
function requestMedicine() {
    const patientId = parseInt(document.getElementById('requestMedicinePatient').value);
    const medicineId = parseInt(document.getElementById('requestMedicineSelect').value);
    const qty = parseInt(document.getElementById('requestMedicineQty').value);

    if (!patientId || !medicineId || !qty) {
        alert('Preencha todos os campos');
        return;
    }

    const patient = app.patients.find(p => p.id === patientId);
    const medicine = app.medicines.find(m => m.id === medicineId);

    const request = {
        id: Date.now(),
        type: 'medicine',
        patientName: patient.name,
        itemName: medicine.name,
        quantity: qty,
        status: 'pendente',
        author: app.currentUser.name,
        timestamp: new Date().toLocaleString('pt-BR')
    };

    app.requests.push(request);
    saveToLocalStorage();
    loadRequests();
    closeModal('requestMedicineModal');
    alert('‚úÖ Solicita√ß√£o enviada!');
}

function requestMaterial() {
    const patientId = parseInt(document.getElementById('requestMaterialPatient').value);
    const materialId = parseInt(document.getElementById('requestMaterialSelect').value);
    const qty = parseInt(document.getElementById('requestMaterialQty').value);

    if (!patientId || !materialId || !qty) {
        alert('Preencha todos os campos');
        return;
    }

    const patient = app.patients.find(p => p.id === patientId);
    const material = app.materials.find(m => m.id === materialId);

    const request = {
        id: Date.now(),
        type: 'material',
        patientName: patient.name,
        itemName: material.name,
        quantity: qty,
        status: 'pendente',
        author: app.currentUser.name,
        timestamp: new Date().toLocaleString('pt-BR')
    };

    app.requests.push(request);
    saveToLocalStorage();
    loadRequests();
    closeModal('requestMaterialModal');
    alert('‚úÖ Solicita√ß√£o enviada!');
}

function loadRequests() {
    const list = document.getElementById('requestsList');
    list.innerHTML = '';

    if (app.requests.length === 0) {
        list.innerHTML = '<p style="color: #999;">Nenhuma solicita√ß√£o</p>';
        return;
    }

    app.requests.slice().reverse().forEach(req => {
        list.innerHTML += `
            <div class="card">
                <div class="card-title">${req.itemName}</div>
                <div class="card-subtitle">Paciente: ${req.patientName} | Qtd: ${req.quantity}</div>
                <small>Status: ${req.status} | ${req.timestamp}</small>
            </div>
        `;
    });
}

// ===== TASKS =====
function loadTasks() {
    const list = document.getElementById('tasksList');
    list.innerHTML = '';

    if (app.tasks.length === 0) {
        list.innerHTML = '<p style="color: #999;">Nenhuma tarefa</p>';
        return;
    }

    app.tasks.forEach(task => {
        list.innerHTML += `
            <div class="card">
                <div class="card-title">${task.description}</div>
                <small>${task.timestamp}</small>
            </div>
        `;
    });

    document.getElementById('pendingTasks').textContent = app.tasks.length;
}

// ===== CHAT =====
function sendMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value;

    if (!message) return;

    const msg = {
        author: app.currentUser.name,
        text: message,
        timestamp: new Date().toLocaleString('pt-BR')
    };

    app.messages.push(msg);
    input.value = '';
    loadChat();
    saveToLocalStorage();
}

function sendColaboradorMessage() {
    const input = document.getElementById('colaboradorChatInput');
    const message = input.value;

    if (!message) return;

    const msg = {
        author: app.currentUser.name,
        text: message,
        timestamp: new Date().toLocaleString('pt-BR')
    };

    app.messages.push(msg);
    input.value = '';
    loadColaboradorChat();
    saveToLocalStorage();
}

function loadChat() {
    const chat = document.getElementById('chatMessages');
    chat.innerHTML = '';

    app.messages.forEach(msg => {
        chat.innerHTML += `
            <div style="margin-bottom: 10px; padding: 10px; background: var(--light-gray); border-radius: 8px;">
                <strong>${msg.author}</strong> <small>${msg.timestamp}</small><br>
                ${msg.text}
            </div>
        `;
    });

    chat.scrollTop = chat.scrollHeight;
}

function loadColaboradorChat() {
    const chat = document.getElementById('colaboradorChatMessages');
    chat.innerHTML = '';

    app.messages.forEach(msg => {
        chat.innerHTML += `
            <div style="margin-bottom: 10px; padding: 10px; background: var(--light-gray); border-radius: 8px;">
                <strong>${msg.author}</strong> <small>${msg.timestamp}</small><br>
                ${msg.text}
            </div>
        `;
    });

    chat.scrollTop = chat.scrollHeight;
}

// ===== REPORTS =====
function generateReport() {
    const type = document.getElementById('reportType').value;
    const report = `üìä RELAT√ìRIO ${type.toUpperCase()}\n\nData: ${new Date().toLocaleString('pt-BR')}\nGestor: ${app.currentUser.name}\n\nPACIENTES: ${app.patients.length}\nAVALIA√á√ïES: ${app.evaluations.length}\nSINAIS VITAIS: ${app.vitals.length}\nSOLICITA√á√ïES: ${app.requests.length}`;
    
    alert(report);
}

function exportReportPDF() {
    const content = `RELAT√ìRIO - ${new Date().toLocaleString('pt-BR')}\n\nPacientes: ${app.patients.length}\nAvalia√ß√µes: ${app.evaluations.length}\nSinais Vitais: ${app.vitals.length}\nSolicita√ß√µes: ${app.requests.length}`;
    downloadFile(content, 'relatorio.txt');
}

// ===== HELPERS =====
function populatePatientSelects() {
    const selects = ['evalPatient', 'vitalsPatient', 'technicalEvalPatient', 'requestMedicinePatient', 'requestMaterialPatient'];
    selects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select) {
            select.innerHTML = '';
            app.patients.forEach(patient => {
                select.innerHTML += `<option value="${patient.id}">${patient.name}</option>`;
            });
        }
    });
}

function populateMedicineSelect() {
    const select = document.getElementById('requestMedicineSelect');
    select.innerHTML = '';
    app.medicines.forEach(med => {
        select.innerHTML += `<option value="${med.id}">${med.name}</option>`;
    });
}

function populateMaterialSelect() {
    const select = document.getElementById('requestMaterialSelect');
    select.innerHTML = '';
    app.materials.forEach(mat => {
        select.innerHTML += `<option value="${mat.id}">${mat.name}</option>`;
    });
}

function updateDateTime() {
    const now = new Date();
    const dateStr = now.toLocaleDateString('pt-BR', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    document.getElementById('currentDate').textContent = dateStr;
    document.getElementById('currentDateColaborador').textContent = dateStr;
}

function generateAISummary() {
    const summary = `üìä RESUMO DO DIA\n\n‚úÖ Pacientes Ativos: ${app.patients.length}\n‚ö†Ô∏è Sinais Cr√≠ticos: ${app.vitals.filter(v => v.isAbnormal).length}\nüìã Avalia√ß√µes: ${app.evaluations.length}\nüì¶ Solicita√ß√µes: ${app.requests.length}`;
    
    document.getElementById('aiContent').textContent = summary;
}

function downloadFile(content, filename) {
    const element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
    element.setAttribute('download', filename);
    element.style.display = 'none';
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
}

function saveToLocalStorage() {
    localStorage.setItem('nursecare_app', JSON.stringify(app));
}

function loadFromLocalStorage() {
    const data = localStorage.getItem('nursecare_app');
    if (data) {
        const loaded = JSON.parse(data);
        app = { ...app, ...loaded };
    }
}

function loadAllData() {
    loadFromLocalStorage();
    loadPatients();
    loadCollaborators();
    loadMedicines();
    loadMaterials();
    loadTasks();
    loadChat();
    loadColaboradorChat();
}

// Initialize
window.addEventListener('load', () => {
    loadFromLocalStorage();
    updateDateTime();
    setInterval(updateDateTime, 60000);
});
</script>

</body>
</html>
